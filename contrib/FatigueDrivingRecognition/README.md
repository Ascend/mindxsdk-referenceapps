# 疲劳驾驶识别（Fatigue driving recognition）

## 1 介绍
本开发样例演示驾驶人员疲劳状态识别系统（Fatigue driving recognition），供用户参考。本系统基于mxVision SDK进行开发，以昇腾Atlas300卡为主要的硬件平台，实现在驾驶环境下驾驶人员疲劳状态识别与预警。

项目的整体流程如下：

1. 利用人脸检测模型采集视频中的人脸图像
2. 利用PFLD模型进行人脸关键点检测，获取眼部位置信息
3. 通过计算度量疲劳/瞌睡的物理量PERCLOS识别驾驶人员的疲劳状态

### 1.1 支持的产品

本项目以昇腾Atlas310卡为主要的硬件平台。

### 1.2 支持的版本

支持的SDK版本为2.0.2，版本号查询方法：在Atlas产品环境下，运行命令：

```
npu-smi info
```

### 1.3 软件方案介绍

请先总体介绍项目的方案架构。如果项目设计方案中涉及子系统，请详细描述各子系统功能。如果设计了不同的功能模块，则请详细描述各模块功能。

表1.1 系统方案中各模块功能描述：

| 序号 |      子系统      | 功能描述                                                     |
| :--: | :--------------: | :----------------------------------------------------------- |
|  1   |     视频输入     | 调用MindX SDK的mxpi_rtspsrc插件对视频数据进行拉流            |
|  2   |     视频解码     | 调用MindX SDK的mxpi_videodecoder进行视频解码                 |
|  3   |     图像放缩     | 调用MindX SDK的mxpi_imageresize进行图像缩放                  |
|  4   |     人脸检测     | 利用yolov4的检测模型检测出图片中的人脸                       |
|  5   |  人脸检测后处理  | 调用yolov4模型后处理插件对检测结果进行后处理                 |
|  6   |     裁剪图片     | 调用MindX SDK的mxpi_imagecrop进行图像裁剪                    |
|  7   |  人脸关键点检测  | 利用PFLD检测模型检测出图片中人脸的106个关键点                |
|  8   | 人脸关键点后处理 | 根据PFLD模型的检测结果进行后处理，获取嘴部相关关键点以及嘴部纵横比信息 |
|  9   |     结果输出     | 输出驾驶人员的疲劳状态并进行可视化输出                       |

### 1.4 代码目录结构与说明

eg：本sample工程名称为XXX，工程目录如下图所示：



### 1.5 技术实现流程图

（可放入流程图片）



## 2 模型转换

由于原模型为onnx模型，需借助ACT工具将onnx模型转换为om模型。模型转换时应先按照[准备动作](https://support.huaweicloud.com/atc-model-convert-cann202infer/atlasatc_16_0005.html)
配置好环境和设置环境变量，然后执行以下命令：

```shell
atc --framework=5 --model={model_path} --output={output_path} --input_format=NCHW --insert_op_conf={aippconfig_path}  --input_shape="input_1:1,3,112,112" --log=debug --soc_version=Ascend310
```

## 2 环境依赖

请列出环境依赖软件和版本。

eg：推荐系统为ubantu 18.04或centos 7.6，环境依赖软件和版本如下表：

| 软件名称 | 版本   |
| -------- | ------ |
| XXX软件  | 版本号 |
|          |        |
|          |        |

在编译运行项目前，需要设置环境变量：

（请列出所需环境变量，作用，若不涉及个人变量，列出实际设置环境变量的命令）

- 环境变量介绍

```
列出具体执行命令
```



## 依赖安装

（依赖搭建安装或者获取方式的具体步骤）



## 编译与运行
（描述项目安装运行的全部步骤，，如果不涉及个人路径，请直接列出具体执行命令）

示例步骤如下：
**步骤1** （修改相应文件）

**步骤2** （设置环境变量）

**步骤3** （执行编译的步骤）

**步骤4** （运行及输出结果）





## 5 软件依赖说明

推理中涉及到第三方软件依赖如下表所示。

| 依赖软件 | 版本                      | 说明                           |
| -------- | ------------------------- | ------------------------------ |
| live555  | 1.09                      | 实现视频转rstp进行推流         |
| ffmpeg   | 2021-08-08-git-ac0408522a | 实现mp4格式视频转为264格式视频 |

注：1.[live555使用教程](https://gitee.com/ascend/mindxsdk-referenceapps/blob/master/docs/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/Live555%E7%A6%BB%E7%BA%BF%E8%A7%86%E9%A2%91%E8%BD%ACRTSP%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3.md)

 2.[ffmpeg使用教程](https://gitee.com/ascend/mindxsdk-referenceapps/blob/master/docs/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/pc%E7%AB%AFffmpeg%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.md)



## 6 常见问题

请按照问题重要程度，详细列出可能要到的问题，和解决方法。

### 6.1 XXX问题

**问题描述：**

截图或报错信息

**解决方案：**

详细描述解决方法。